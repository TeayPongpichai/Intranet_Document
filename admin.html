<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Admin ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .hidden { display: none; }
    .status { margin-top: 10px; font-weight: bold; }
    .category-radio {
      display: flex;
      gap: 20px;
      align-items: center;
      margin: 10px 0;
    }
    .category-radio label {
      font-weight: bold;
    }
    .filetype-radio {
      display: flex;
      gap: 15px;
      align-items: center;
      margin: 10px 0;
    }
    .filetype-radio label {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 0.9em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    thead {
      background-color: #3B7168;
      color: white;
    }
    th {
      font-weight: bold;
    }
    .expired-header {
      margin-top: 10px;
      font-size: 1em;
      font-weight: bold;
      color: #3B7168;
    }
    .flex-container {
      display: flex;
      gap: 5px;
      align-items: flex-start;
    }
    .left-form {
      flex: 4.0;
      min-width: 0;
    }
    .right-expired {
      flex: 6.0;
      min-width: 0;
    }
  </style>
</head>
<body>
  <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Admin)</h2>

  <div id="passwordSection">
    <input type="password" id="adminPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
    <button onclick="checkPassword()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <div id="passwordStatus" class="status"></div>
  </div>

  <div id="adminPanel" class="hidden">
    <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h2>

    <div class="category-radio">
      <label>üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label>
      <label><input type="radio" name="category" value="master" checked> üìã Master List</label>
      <label><input type="radio" name="category" value="patient"> üìö Patient Instruction</label>
    </div>

    <label>üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:</label>
    <input type="text" id="searchCode" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£">
    <button onclick="searchDoc()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
    <button onclick="clearForm()">üßπ ‡∏•‡πâ‡∏≤‡∏á</button>

    <hr>

    <div class="flex-container">
      <div class="left-form">
        <form id="docForm">
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô:</label><br>
          <input type="text" id="dept" required><br>

          <label>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£:</label><br>
          <input type="text" id="code" required><br>

          <label>Rev:</label><br>
          <input type="text" id="rev" required><br>

          <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</label><br>
          <input type="text" id="title" required><br>

          <label>‚úÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ:</label><br>
          <input type="date" id="startDate" required><br>

          <label>‚õî ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</label><br>
          <input type="date" id="endDate"><br>

          <label>üìÑ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå:</label>
          <div class="filetype-radio">
            <label><input type="radio" name="fileTypeRadio" value="PDF">PDF</label>
            <label><input type="radio" name="fileTypeRadio" value="WORD">WORD</label>
            <label><input type="radio" name="fileTypeRadio" value="EXCEL">EXCEL</label>
            <label><input type="radio" name="fileTypeRadio" value="other">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ:</label>
            <input type="text" id="fileType" placeholder="‡∏£‡∏∞‡∏ö‡∏∏ ‡πÄ‡∏ä‡πà‡∏ô PPT, TXT" disabled>
          </div>

          <label>üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏£‡∏∑‡∏≠ path:</label><br>
          <input type="text" id="link" required><br><br>

          <button type="button" onclick="addDoc()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button type="button" onclick="deleteDoc()">üóëÔ∏è ‡∏•‡∏ö</button>
        </form>

        <pre id="status" class="status"></pre>
      </div>

      <div class="right-expired">
        <div class="expired-header">üìÅ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß</div>
        <table id="expiredTable">
          <thead>
            <tr>
              <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
              <th>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th>
              <th>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏ä‡πâ</th>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
              <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå</th>
              <th>Download</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbykNCPNYmKCuCaA7mUcusnHEAQqmSomudpmPJDYp2qucwuzBDR_lNWJH2YYSJaMBo2KuA/exec';
    const ADMIN_PASSWORD = '1234';
    let currentData = [];

    function checkPassword() {
      const input = document.getElementById("adminPassword").value;
      if (input === ADMIN_PASSWORD) {
        document.getElementById("passwordSection").style.display = "none";
        document.getElementById("adminPanel").classList.remove("hidden");
        loadData();
      } else {
        document.getElementById("passwordStatus").textContent = "‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
      }
    }

    function loadData() {
      fetch(GAS_URL)
        .then(res => res.json())
        .then(data => {
          currentData = data;
          renderExpiredTable();
        });
    }

    function renderExpiredTable() {
      const tbody = document.querySelector("#expiredTable tbody");
      tbody.innerHTML = "";
      const today = new Date();
      const expired = currentData.filter(item => item.endDate && new Date(item.endDate) < today);
      expired.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.dept}</td>
          <td>${item.code}</td>
          <td>${item.startDate}</td>
          <td>${item.endDate}</td>
          <td>${item.fileType || '-'}</td>
          <td><a href="${item.link}" target="_blank">Click</a></td>
        `;
        tbody.appendChild(row);
      });
    }

    function searchDoc() {
      const code = document.getElementById('searchCode').value.trim();
      const found = currentData.find(item => item.code === code);
      if (found) {
        document.getElementById('dept').value = found.dept;
        document.getElementById('code').value = found.code;
        document.getElementById('rev').value = found.rev;
        document.getElementById('title').value = found.title;
        document.getElementById('startDate').value = found.startDate;
        document.getElementById('endDate').value = found.endDate;
        document.getElementById('fileType').value = found.fileType || "";
        document.getElementById('link').value = found.link;
        const radio = document.querySelector(`input[name="category"][value="${found.category}"]`);
        if (radio) radio.checked = true;
        document.getElementById("status").textContent = "‚úèÔ∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
      } else {
        document.getElementById("status").textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ";
      }
    }

    function clearForm() {
      document.getElementById('docForm').reset();
      document.getElementById('searchCode').value = "";
      document.getElementById('fileType').value = "";
      document.querySelector('input[name="category"][value="master"]').checked = true;
      document.getElementById("status").textContent = "üßº ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß";
    }

    document.querySelectorAll('input[name="fileTypeRadio"]').forEach(radio => {
      radio.addEventListener('change', function () {
        const fileTypeInput = document.getElementById('fileType');
        if (this.value === 'other') {
          fileTypeInput.disabled = false;
          fileTypeInput.value = '';
        } else {
          fileTypeInput.disabled = true;
          fileTypeInput.value = this.value;
        }
      });
    });

    async function addDoc() {
      if (!document.getElementById('docForm').checkValidity()) {
        document.getElementById("status").textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á";
        return;
      }
      await loadData();

      const doc = {
        dept: document.getElementById('dept').value,
        code: document.getElementById('code').value,
        rev: document.getElementById('rev').value,
        title: document.getElementById('title').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        fileType: document.getElementById('fileType').value,
        link: document.getElementById('link').value,
        category: document.querySelector('input[name="category"]:checked').value
      };

      const index = currentData.findIndex(item => item.code === doc.code);
      if (index !== -1) {
        currentData[index] = doc;
      } else {
        currentData.push(doc);
      }

      const res = await fetch(GAS_URL, {
        method: "POST",
        body: JSON.stringify(currentData)
      });

      await res.json();
      clearForm();
      document.getElementById("status").textContent = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
      loadData();
    }

    async function deleteDoc() {
      const code = document.getElementById('code').value.trim();
      if (!code) {
        document.getElementById("status").textContent = "‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö";
        return;
      }
      await loadData();
      const index = currentData.findIndex(item => item.code === code);
      if (index === -1) {
        document.getElementById("status").textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö";
        return;
      }
      if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ${code} ?`)) return;
      currentData.splice(index, 1);
      const res = await fetch(GAS_URL, {
        method: "POST",
        body: JSON.stringify(currentData)
      });
      await res.json();
      clearForm();
      document.getElementById("status").textContent = "üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
      loadData();
    }

    document.getElementById("adminPassword").addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        checkPassword();
      }
    });
  </script>
</body>
</html>
