<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Admin à¹€à¸à¸´à¹ˆà¸¡à¹€à¸­à¸à¸ªà¸²à¸£</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .hidden { display: none; }
    .status { margin-top: 10px; font-weight: bold; }
    .category-radio {
      display: flex;
      gap: 20px;
      align-items: center;
      margin: 10px 0;
    }
    .category-radio label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥ (Admin)</h2>

  <div id="passwordSection">
    <input type="password" id="adminPassword" placeholder="à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™">
    <button onclick="checkPassword()">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
    <div id="passwordStatus" class="status"></div>
  </div>

  <div id="adminPanel" class="hidden">
    <h2>à¸ˆà¸±à¸”à¸à¸²à¸£à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸­à¸à¸ªà¸²à¸£</h2>

    <div class="category-radio">
      <label>ğŸ“‚ à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ:</label>
      <label><input type="radio" name="category" value="master" checked> ğŸ“‹ Master List</label>
      <label><input type="radio" name="category" value="patient"> ğŸ§¾ Patient Instruction</label>
    </div>

    <label>ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¸£à¸«à¸±à¸ªà¹€à¸­à¸à¸ªà¸²à¸£:</label>
    <input type="text" id="searchCode" placeholder="à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¹€à¸­à¸à¸ªà¸²à¸£">
    <button onclick="searchDoc()">à¸„à¹‰à¸™à¸«à¸²</button>
    <button onclick="clearForm()">ğŸ§¹ à¸¥à¹‰à¸²à¸‡</button>

    <hr>

    <form id="docForm">
      <label>à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™:</label><br>
      <input type="text" id="dept" required><br>

      <label>à¸£à¸«à¸±à¸ªà¹€à¸­à¸à¸ªà¸²à¸£:</label><br>
      <input type="text" id="code" required><br>

      <label>Rev:</label><br>
      <input type="text" id="rev" required><br>

      <label>à¸£à¸²à¸¢à¸à¸²à¸£:</label><br>
      <input type="text" id="title" required><br>

      <label>ğŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸Šà¹‰:</label><br>
      <input type="date" id="startDate" required><br>

      <label>ğŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”:</label><br>
      <input type="date" id="endDate"><br>

      <label>ğŸ“„ à¸›à¸£à¸°à¹€à¸ à¸—à¹„à¸Ÿà¸¥à¹Œ (à¹€à¸Šà¹ˆà¸™ PDF, DOCX):</label><br>
      <input type="text" id="fileType"><br>

      <label>ğŸ”— à¸¥à¸´à¸‡à¸à¹Œà¸«à¸£à¸·à¸­ path:</label><br>
      <input type="text" id="link" required><br><br>

      <button type="button" onclick="addDoc()">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸ / à¹à¸à¹‰à¹„à¸‚</button>
      <button type="button" onclick="deleteDoc()">ğŸ—‘ï¸ à¸¥à¸š</button>
    </form>

    <pre id="status" class="status"></pre>
  </div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbykNCPNYmKCuCaA7mUcusnHEAQqmSomudpmPJDYp2qucwuzBDR_lNWJH2YYSJaMBo2KuA/exec';
    const ADMIN_PASSWORD = '1234';

    let currentData = [];

    function checkPassword() {
      const input = document.getElementById("adminPassword").value;
      if (input === ADMIN_PASSWORD) {
        document.getElementById("passwordSection").style.display = "none";
        document.getElementById("adminPanel").classList.remove("hidden");
        loadData();
      } else {
        document.getElementById("passwordStatus").textContent = "âŒ à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡";
      }
    }

    function loadData() {
      return fetch(GAS_URL)
        .then(res => res.json())
        .then(data => { currentData = data; });
    }

    function searchDoc() {
      const code = document.getElementById('searchCode').value.trim();
      const found = currentData.find(item => item.code === code);
      if (found) {
        document.getElementById('dept').value = found.dept;
        document.getElementById('code').value = found.code;
        document.getElementById('rev').value = found.rev;
        document.getElementById('title').value = found.title;
        document.getElementById('startDate').value = found.startDate;
        document.getElementById('endDate').value = found.endDate;
        document.getElementById('fileType').value = found.fileType || "";
        document.getElementById('link').value = found.link;
        const radio = document.querySelector(`input[name="category"][value="${found.category}"]`);
        if (radio) radio.checked = true;
        document.getElementById("status").textContent = "âœï¸ à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¹‰à¸­à¸¡à¹à¸à¹‰à¹„à¸‚";
      } else {
        document.getElementById("status").textContent = "âŒ à¹„à¸¡à¹ˆà¸à¸šà¸£à¸«à¸±à¸ªà¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰";
      }
    }

    function clearForm() {
      document.getElementById('docForm').reset();
      document.getElementById('searchCode').value = "";
      document.getElementById('fileType').value = "";
      document.querySelector('input[name="category"][value="master"]').checked = true;
      document.getElementById("status").textContent = "ğŸ§¼ à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¥à¹‰à¸§";
    }

    async function addDoc() {
      if (!document.getElementById('docForm').checkValidity()) {
        document.getElementById("status").textContent = "âš ï¸ à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸—à¸¸à¸à¸Šà¹ˆà¸­à¸‡";
        return;
      }
      await loadData();

      const doc = {
        dept: document.getElementById('dept').value,
        code: document.getElementById('code').value,
        rev: document.getElementById('rev').value,
        title: document.getElementById('title').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        fileType: document.getElementById('fileType').value,
        link: document.getElementById('link').value,
        category: document.querySelector('input[name="category"]:checked').value
      };

      const index = currentData.findIndex(item => item.code === doc.code);
      if (index !== -1) {
        currentData[index] = doc;
      } else {
        currentData.push(doc);
      }

      const res = await fetch(GAS_URL, {
        method: "POST",
        body: JSON.stringify(currentData)
      });

      await res.json();
      clearForm();  // âœ… à¸¥à¹‰à¸²à¸‡à¸à¹ˆà¸­à¸™
      document.getElementById("status").textContent = "âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ";  // âœ… à¹„à¸¡à¹ˆà¹‚à¸”à¸™à¸¥à¹‰à¸²à¸‡à¸—à¸±à¸š
    }

    async function deleteDoc() {
      const code = document.getElementById('code').value.trim();
      if (!code) {
        document.getElementById("status").textContent = "âš ï¸ à¸•à¹‰à¸­à¸‡à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¹€à¸­à¸à¸ªà¸²à¸£à¸à¹ˆà¸­à¸™à¸¥à¸š";
        return;
      }
      await loadData();
      const index = currentData.findIndex(item => item.code === code);
      if (index === -1) {
        document.getElementById("status").textContent = "âŒ à¹„à¸¡à¹ˆà¸à¸šà¹€à¸­à¸à¸ªà¸²à¸£à¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¸š";
        return;
      }
      if (!confirm(`à¸„à¸¸à¸“à¹à¸™à¹ˆà¹ƒà¸ˆà¸§à¹ˆà¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¹€à¸­à¸à¸ªà¸²à¸£ ${code} ?`)) return;
      currentData.splice(index, 1);
      const res = await fetch(GAS_URL, {
        method: "POST",
        body: JSON.stringify(currentData)
      });
      await res.json();
      clearForm();
      document.getElementById("status").textContent = "ğŸ—‘ï¸ à¸¥à¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ";
    }

    document.getElementById("adminPassword").addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        checkPassword();
      }
    });
  </script>
</body>
</html>
